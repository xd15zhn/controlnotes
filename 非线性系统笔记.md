# 线性化的几个例子
线性化就是将$\frac{dx}{dt}=f(x)$变成$\frac{dx}{dt}=Ax$。$\frac{dx}{dt}=f(x_0)+f'(x_0)(x-x_0)$令$z=x-x_0$，则$\frac{dz}{dt}=f(x_0)+f'(x_0)z$
## 例1
液位。
$$C\frac{\text{d}y}{\text{d}t}+3\sqrt{y}=u$$
平衡点$y_0=4$，$u_0=6$。
$$C\frac{\text{d}(y_0+\Delta y)}{\text{d}t}+3\sqrt{y_0+\Delta y}=u_0+\Delta u$$
$$3\sqrt{y_0+\Delta y}=3\sqrt{y_0}+\frac{3}{2\sqrt{y_0}}\Delta y$$
$$C\frac{\text{d}\Delta y}{\text{d}t}+0.75\Delta y=\Delta u$$
## 例2
单摆。
$$\frac{d^2\theta}{dt^2}+4\sin\theta=u$$
平衡点$\theta_0=\frac{\pi}{6}$，$u_0=2$。
状态方程
$$\begin{cases}
x_1'=f_1(\boldsymbol{x},u)=x_2\\
x_2'=f_2(\boldsymbol{x},u)=u-4\sin x_1
\end{cases}$$
多元函数泰勒展开
$$f(x,y,z)=\frac{\partial f}{\partial x}(x-x_0)+\frac{\partial f}{\partial y}(y-y_0)+\frac{\partial f}{\partial z}(z-z_0)$$
所以
$$f_2(\boldsymbol{x},u)=f_{20}+\Delta u-4\cos\theta_0\Delta\theta$$
又因为平衡点$x_2'=0$，所以$f_{20}=0$，$x_2'=-2\sqrt{3}x_1+u$
## 例3
倒立摆。见 <https://gitee.com/xd15zhn/inversependular/releases/download/V0.2/main.pdf>
## 参考资料
[为什么非线性系统线性化一定要在平衡位置？](https://www.zhihu.com/question/22475259)
[Linearization of Nonlinear Models](https://eng.libretexts.org/Bookshelves/Industrial_and_Systems_Engineering/Book%3A_Introduction_to_Control_Systems_(Iqbal)/01%3A_Mathematical_Models_of_Physical_Systems/1.07%3A_Linearization_of_Nonlinear_Models)

# 范数与$\mathcal{L}_p$空间
如果说一个信号属于 $\mathcal{L}_\infty$，指的是这个信号是有界信号，即
$$\mathcal{L}_\infty: ||u||_{\mathcal{L}_\infty}=\sup_{t\ge 0}|u(t)|<\infty$$
如果说一个信号属于 $\mathcal{L}_2$，指的是这个信号平方可积，即
$$\mathcal{L}_2: ||u||_{\mathcal{L}_2}=
\sqrt{\int_0^\infty u^\text{T}(t)u(t)\text{d}t}<\infty$$
属于 $\mathcal{L}_p$
$$\mathcal{L}_p: ||u||_{\mathcal{L}_p}=
\left(\int_0^\infty |u(t)|^p\text{d}t\right)^\frac{1}{p}<\infty$$

# 参数估计
## 一阶系统参数估计
对被控对象 $y'=a+bu$，$a$ 和 $b$ 均未知。写成矩阵形式
$$y'=\theta^{*\text{T}}\phi=
\begin{bmatrix} a & b \end{bmatrix}
\begin{bmatrix} 1 \\ u \end{bmatrix}$$
取 $u=\frac{1}{b}(-a-ky+ky_m+y_m')$，则
$$\begin{aligned}
& y'=-ky+ky_m + y_m' \\
& (y-y_m)'=-k(y-y_m) \\
\end{aligned}$$
$a,b$ 的估计值分别记作 $\hat{a},\hat{b}$，则 $y_m'=\hat{b}u+\hat{a}+ky-ky_m$。
定义参数估计误差 $\tilde\theta(t)=\hat\theta(t)-\theta^*$ 和跟踪误差 $e=y-y_m$，则 $\tilde\theta'(t)=\hat\theta'(t)$，
$$\begin{aligned}
e'(t) =& y'-y_m' \\
=& a+bu - (\hat{a}+\hat{b}u+ky-ky_m) \\
=& a-\hat a+(b-\hat b)u-ke=-ke-\tilde\theta^\text{T}\phi
\end{aligned}$$
取候选李雅普诺夫函数
$$V(e,\tilde\theta) = \frac{1}{2}e^2+\frac{1}{2}\tilde\theta^\text{T}\tilde\theta$$
则
$$\begin{aligned}
V' =& ee'+\tilde\theta^\text{T}\tilde\theta' \\
=& e(-ke-\tilde\theta^\text{T}\phi)+\tilde\theta^\text{T}\tilde\theta' \\
=& -ke^2 + \tilde\theta^\text{T}(\hat\theta'-e\phi)
\end{aligned}$$
取 $\hat\theta'=e\phi$ 时可使得 $V$ 是李雅普诺夫函数，即
$$\begin{aligned}
\hat a' =& e \\
\hat b' =& eu \\
\end{aligned}$$

## 高阶系统参数估计
对被控对象
$$\begin{aligned}
&x'=Ax+Bu \\
&y=Cx \\
\end{aligned}$$
$A,B,C$ 均未知。
注意到 $B,C$ 不可逆，对 $y$ 求导
$$y'=Cx'=CAx+CBu$$
取 $\widehat{CA},\widehat{CB}$ 为待估计的参数，则取
$$u=\frac{1}{\widehat{CB}}\left[-\widehat{CA}x+y_m'-K(y-y_m)\right]$$
当参数估计误差为0时，代入 $y$ 得
$$y'-y_m'=-K(y-y_m)$$
误差不为0时，$y_m'=\widehat{CB}u+\widehat{CA}x+Ky-Ky_m$。记
$$
y'=\theta^{*\text{T}}\phi=\begin{bmatrix} CA & CB \end{bmatrix}
\begin{bmatrix} x \\ u \end{bmatrix}
$$
设 $\tilde\theta(t)=\hat\theta(t)-\theta^*,e=y-y_m$，则
$$\begin{aligned}
e'(t) =& y'-y_m' \\
=& CAx+CBu - (\widehat{CB}u+\widehat{CA}x+Ky-Ky_m) \\
=& (CA-\widehat{CA})x+(CB-\widehat{CB})u-ke=-ke-\tilde\theta^\text{T}\phi
\end{aligned}$$
取候选李雅普诺夫函数
$$V(e,\tilde\theta) = \frac{1}{2}e^2+\frac{1}{2}\tilde\theta^\text{T}\tilde\theta$$
剩下步骤与一阶系统相同。

# 反步法
$$
x_1'=x_2+\phi_1(x_1) \\
x_2'=\theta\phi_2(\vec{x})+u
$$
令 $y=x_1$，则 $y'=x_1'=x_2+\phi_1(x)$，$y''=\theta\phi_1(x)-k_1y'+k_2y$

反步法，设计虚拟控制 $x_2\rightarrow\alpha_1(x_1)=-\phi_1(x_1)-c_1x_1$，则 $x_1'=-c_1x_1$，收敛；
取李雅普诺夫候选
$$ V = \frac{1}{2}x_1^2+\frac{1}{2}(x_2-\alpha_1(x_1))^2 $$
则
$$\begin{aligned}
V' =& x_1x_1'+(x_2-\alpha_1(x_1))(x_2-\alpha_1(x_1))' \\
=& x_1x_2+x_1\phi_1+(x_2+\phi_1+c_1x_1)(\theta\phi_2+u-\alpha_1') \\
\end{aligned}$$
取
$$
u=-\theta\phi_2+\alpha_1'-x_1-c_2(x_2-\alpha_1)
$$
代入得
$$\begin{aligned}
V'=& x_1x_2+x_1\phi_1+(x_2+\phi_1+c_1x_1)(-x_1-c_2(x_2-\alpha_1)) \\
=&-c_1x_1^2+(x_2-\alpha_1)(-c_2x_2+c_2\alpha_1) \\
=& -c_1x_1^2-c_2(x_2-\alpha_1)^2
\end{aligned}$$
对系统
$$\begin{aligned}
& x_1'=\theta\phi_1(x_1)+x_2 \\
& x_2'=u
\end{aligned}$$
设 $\alpha_1(x_1)=-\theta\phi_1(x_1)-c_1x_1$
取李雅普诺夫候选
$$ V_1= $$
取
$$ u=-c_2(x_2-\alpha(x_1,\theta))-x_1
+\frac{\partial\alpha_1}{\partial x_1}(x_1+\theta\phi) $$
则 
$$\begin{aligned}
V'=& x_1x_2+x_1\phi_1+(x_2+\phi_1+c_1x_1)(-x_1-c_2(x_2-\alpha_1)) \\
=&-c_1x_1^2+(x_2-\alpha_1)(-c_2x_2+c_2\alpha_1) \\
=& -c_1x_1^2-c_2(x_2-\alpha_1(x_1))^2
\end{aligned}$$

# 相对阶
[非线性系统的反馈线性化](https://blog.csdn.net/qq_34288751/article/details/129697166)

# 作业
考虑 $x'= f(x)+g(x)u,y=h(x),x\in\mathbb{R}^n,u\in\mathbb{R},y\in\mathbb{R},f(0)=0$
1. 已知系统的相对阶为 $n$，设计 $u$ 使得 $\forall x(0)\in\mathbb{R}^n$，$x$ 指数收敛到0。
2. 设计 $u$ 使得
(a) $\forall y(0)\in\mathbb{R}$，$y$ 指数收敛到0。
(b) $y$ 指数收敛到 $y_m$，其中 $y_m$ 是已知参考信号。
